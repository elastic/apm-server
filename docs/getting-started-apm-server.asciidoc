[[getting-started-apm-server]]
== Getting Started With APM Server

// This section was copied from the APM Overview
// Switch to tagged regions when available
The easiest way to get started with APM Server is by using our
https://www.elastic.co/cloud/elasticsearch-service[hosted {es} Service] on
Elastic Cloud. The {es} Service is available on both AWS and GCP,
and automatically configures APM Server to work with {es} and {kib}.

[float]
=== Hosted Elasticsearch Service

Skip managing your own {es}, {kib}, and APM Server by using our
https://www.elastic.co/cloud/elasticsearch-service[hosted {es} Service] on
Elastic Cloud.

image::images/apm-architecture-cloud.png[Install Elastic APM on cloud]

https://www.elastic.co/cloud/elasticsearch-service/signup[Try out the {es} Service for free],
then jump to <<apm-server-configuration>>.

[float]
=== Install the stack yourself

If you'd rather install the stack yourself, first see the https://www.elastic.co/support/matrix[Elastic Support Matrix] for information about supported operating systems and product compatibility.

We recommend you use the same version of Elasticsearch, Kibana, and APM Server:

image::images/apm-architecture-diy.png[Install Elastic APM yourself]

* *{es}* for storing and indexing data.
* *{kib}* for visualizing with the APM UI.

See {stack-gs}/get-started-elastic-stack.html[Getting started with the {stack}]
for more information about installing these products.
After installing the {stack}, read the following topics to learn how to install,
configure, and start APM Server:

* <<installing>>
* <<apm-server-configuration>>
* <<start-apm-server>>
* <<next-steps>>

// *******************************************************
// STEP 1
// *******************************************************

[[installing]]
=== Step 1: Install APM Server

*Before you begin*: If you haven't installed the {stack}, do that now.
See {stack-gs}/get-started-elastic-stack.html[Getting started with the {stack}].

To download and install {beatname_uc}, use the commands below that work with your system.
If you use Apt or Yum, you can <<setup-repositories,install {beatname_uc} from our repositories>>
to update to the newest version more easily.

ifeval::["{release-state}"!="unreleased"]
NOTE: See our https://www.elastic.co/downloads/apm[download page]
for other installation options, such as 32-bit images.
endif::[]

[[deb]]
*deb:*

ifeval::["{release-state}"=="unreleased"]

Version {version} of APM Server has not yet been released.

endif::[]

ifeval::["{release-state}"!="unreleased"]

["source","sh",subs="attributes"]
----------------------------------------------------------------------
curl -L -O {downloads}/apm-server-{version}-amd64.deb
sudo dpkg -i apm-server-{version}-amd64.deb
----------------------------------------------------------------------

endif::[]

[[rpm]]
*rpm:*

ifeval::["{release-state}"=="unreleased"]

Version {version} of APM Server has not yet been released.

endif::[]

ifeval::["{release-state}"!="unreleased"]

["source","sh",subs="attributes"]
----------------------------------------------------------------------
curl -L -O {downloads}/apm-server-{version}-x86_64.rpm
sudo rpm -vi apm-server-{version}-x86_64.rpm
----------------------------------------------------------------------

endif::[]

[[mac]]
*mac:*

ifeval::["{release-state}"=="unreleased"]

Version {version} of APM Server has not yet been released.

endif::[]

ifeval::["{release-state}"!="unreleased"]

["source","sh",subs="attributes"]
------------------------------------------------
curl -L -O {downloads}/apm-server-{version}-darwin-x86_64.tar.gz
tar xzvf apm-server-{version}-darwin-x86_64.tar.gz
------------------------------------------------

endif::[]

[[linux]]
*linux:*

ifeval::["{release-state}"=="unreleased"]

Version {version} of APM Server has not yet been released.

endif::[]

ifeval::["{release-state}"!="unreleased"]

["source","sh",subs="attributes"]
------------------------------------------------
curl -L -O {downloads}/apm-server-{version}-linux-x86_64.tar.gz
tar xzvf apm-server-{version}-linux-x86_64.tar.gz
------------------------------------------------
endif::[]

[[docker]]
*docker:*

See <<running-on-docker, Running on Docker>> for deploying Docker containers.

[[installing-on-windows]]
*win:*

ifeval::["{release-state}"=="unreleased"]

Version {version} of APM Server has not yet been released.

endif::[]

ifeval::["{release-state}"!="unreleased"]

. Download the APM Server Windows zip file from the
https://www.elastic.co/downloads/apm/apm-server[downloads page].

. Extract the contents of the zip file into `C:\Program Files`.

. Rename the `apm-server-<version>-windows` directory to `APM-Server`.

. Open a PowerShell prompt as an Administrator (right-click the PowerShell icon and select *Run As Administrator*).
If you are running Windows XP, you may need to download and install PowerShell.

. From the PowerShell prompt, run the following commands to install APM Server as a Windows service:
+
[source,shell]
----------------------------------------------------------------------
PS > cd 'C:\Program Files\APM-Server'
PS C:\Program Files\APM-Server> .\install-service-apm-server.ps1
----------------------------------------------------------------------

NOTE: If script execution is disabled on your system,
you need to set the execution policy for the current session to allow the script to run.
For example: `PowerShell.exe -ExecutionPolicy UnRestricted -File .\install-service-apm-server.ps1`.

endif::[]

// *******************************************************
// STEP 2
// *******************************************************

[[apm-server-configuration]]
=== Step 2: Configure APM Server

[float]
==== Configure Elastic Cloud

If you're running APM Server in Elastic cloud,
you can configure your own user settings right in the Elasticsearch Service Console.
Any changes are automatically appended to the `apm-server.yml` configuration file for your instance.

A full list of configuration options is available in Elastic Cloud's
{cloud}/ec-manage-apm-settings.html[Add APM user settings].

[float]
==== Configure a self installation

If you've installed APM Server yourself,
you can edit the `apm-server.yml` configuration file to customize APM Server to your needs.
The location of the file varies by platform. To locate the file, see <<director-layout>>.
All available configuration options are outlined in
{apm-server-ref-v}/configuring-howto-apm-server.html[configuring APM Server].

[float]
[[index-template-config]]
==== Index template configuration

In Elasticsearch, {ref}/indices-templates.html[index templates] are used to define settings
and mappings that determine how fields should be analyzed.

The recommended index template file for {beatname_uc} is installed by the {beatname_uc} packages.
If you accept the default configuration in the +{beatname_lc}.yml+ config file,
{beatname_uc} loads the template automatically after successfully connecting to Elasticsearch.
If the template already exists,
it's not overwritten unless you configure {beatname_uc} to do so.

More information is available in <<load-template-auto, configure template loading>>.

// *******************************************************
// STEP 3
// *******************************************************

[[start-apm-server]]
=== Step 3: Start APM Server

In a production environment, you would put APM Server on its own machines,
similar to how you run Elasticsearch.
You _can_ run it on the same machines as Elasticsearch, but this is not recommended,
as the processes will be competing for resources.

To start APM Server, run:

[source,bash]
----------------------------------
./apm-server -e
----------------------------------


NOTE: The `-e` <<global-flags,global flag>> above enables logging to stderr and disables syslog/file output.
Remove this flag if you've enabled logging in the configuration file.
For linux systems, see <<running-with-systemd,APM Server status and logs>>.

You should see APM Server start up.
It will try to connect to Elasticsearch on localhost port 9200 and expose an API to agents on port 8200.
You can change the defaults by supplying a different address on the command line:

[source,bash]
----------------------------------
./apm-server -e -E output.elasticsearch.hosts=ElasticsearchAddress:9200 -E apm-server.host=localhost:8200
----------------------------------

[float]
[[running-deb-rpm]]
==== Debian Package / RPM

The Debian package and RPM installations of APM Server create an `apm-server` user.
To start the APM Server in this case, run:

[source,bash]
----------------------------------
sudo -u apm-server apm-server [<argument...>]
----------------------------------

By default, APM Server loads its configuration file from `/etc/apm-server/apm-server.yml`.
See the <<_deb_and_rpm,deb & rpm default paths>> for a full directory layout.

// *******************************************************
// STEP 4
// *******************************************************

[[next-steps]]
=== Step 4: Next steps

?? Quick note about installing/running agents now?
?? Quick note about kibana UI?
?? 

// Shared APM & YUM
include::./copied-from-beats/repositories.asciidoc[]

// Shared docker

include::./copied-from-beats/shared-docker.asciidoc[]