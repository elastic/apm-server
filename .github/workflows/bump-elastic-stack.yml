---
name: bump-elastic-stack-snapshot

on:
  schedule:
    - cron: '0 15 * * 1-5'
  pull_request:

permissions:
  pull-requests: write
  contents: write

jobs:
  filter:
    runs-on: ubuntu-latest
    timeout-minutes: 3
    outputs:
      matrix: ${{ steps.generate.outputs.matrix }}
    steps:
      - id: generator
        shell: python
        run: |
          import os
          import requests
          r = requests.get(url='https://storage.googleapis.com/artifacts-api/snapshots/branches.json')
          with open(os.environ.get('GITHUB_OUTPUT'), "a") as f:
            f.write("matrix={}\n".format(r.json()))
      - id: debug
        run: echo "The branches are ${{ steps.generator.outputs.matrix }}"

  branches:
    runs-on: ubuntu-latest
    needs: [filter]
    strategy:
      matrix:
        branch: ${{ fromJSON(needs.filter.outputs.matrix).branches }}
    steps:
      - run: echo ${{ matrix.branch }}

